---
title: "Lit_Evo_Project"
author: "Thomas FitzGerald"
date: "4/11/2022"
output: html_document
---

Classic Literature is a vaguely defined term at best, but at it's core it's literature that is still read long after it's released.

Fanfiction is also a vaguely defined term, but at it's core it's something written using another author's work as a starting point.  It's also generally not-for-profit, which may explain why we don't hear Robert Jordan or L. Sprague de Camp's works referred to as "Conan Fanfiction".

```{r setup, include=FALSE}
library(dplyr)
library(ggplot2)
library(plotly)
library(reticulate)
df.word<-read.csv('C:\\File\\Lit_Evo_results\\POS_word.csv')
df.word.summary<-read.csv('C:\\File\\Lit_Evo_results\\POS_word_summary.csv')
df.punc<-read.csv('C:\\File\\Lit_Evo_results\\POS_punctuation.csv')
df.pos<-read.csv('C:\\File\\Lit_Evo_results\\POS_all.csv')
df.ss_s<-read.csv('C:\\File\\Lit_Evo_results\\SS_simple.csv')
df.ss_c<-read.csv('C:\\File\\Lit_Evo_results\\SS_complex.csv')
```

Before we move on, let's take a brief look at what our test sample consists of, to provide context for the conclusions we draw later on.

```{r,echo=FALSE} 
dfList<-unique(df.punc %>%select(lit_type,title,author))
dfList$title<-gsub("Ã¨","e",gsub("\n","",dfList$title))

dfList.class<-subset(dfList,lit_type=="Book")
dfList.ff<-subset(dfList,lit_type=="Fanfiction")

table.class <- plot_ly(
  type = 'table',
  columnwidth = c(2, 1),
  columnorder = c(0, 1),
  header = list(
    values = c("Title","Author"),
    align = c("left", "left"),
    line = list(width = 1, color = 'black'),
    fill = list(color = c("grey", "grey")),
    font = list(family = "Arial", size = 14, color = "white")
  ),
  cells = list(
    values = rbind(dfList.class$title, dfList.class$author),
    align = c("left", "left"),
    line = list(color = "black", width = 1),
    font = list(family = "Arial", size = 12, color = c("black"))
  ))

table.ff <- plot_ly(
  type = 'table',
  columnwidth = c(2, 1),
  columnorder = c(0, 1),
  header = list(
    values = c("Title","Author"),
    align = c("left", "left"),
    line = list(width = 1, color = 'black'),
    fill = list(color = c("grey", "grey")),
    font = list(family = "Arial", size = 14, color = "white")
  ),
  cells = list(
    values = rbind(dfList.ff$title, dfList.ff$author),
    align = c("left", "left"),
    line = list(color = "black", width = 1),
    font = list(family = "Arial", size = 12, color = c("black"))
  ))

table.class
table.ff



```

There's a great deal of variation in our classic literature sample that's not immediately apparent from the text.  Three are translations: one from ancient Greek, one from middle English, and one from modern German.  (Oedipus, Sir Gawayne, & Struwwelpeter.)  Three are children's stories(Three little pigs, Secret Garden & Struwwelpeter) two plays(Oedipus and Way of the World), and two poems(Sir Gawayne and Aurora Leigh). The earliest was written in 5th century BC, while the most recent was written in 1953.  

On the fanfiction end, our sample is in some ways much more homogeneous.  Unsurprisingly, since we're lookg at "Modern Fanfiction", all are from the 21st century.  They come from a diverse range of fandoms, although it's worth noting that, with the exception of 'I'd Forgotten People are Kind', a real-person fanfic about a blogger, all fall into either the Sci-Fi or Fantasy genres.  Unlike classic literature, where there's been a greater degree of academic study, genre is difficult to pin down in fanfiction.  One could say that the fanfic inherits the genre of its fandom, but that limits the genre of a story to its setting.
  Based on a highly subjective reading of story tags, 7 appear to have strong romance elements, with tags like "Soulmate","Courtship", or, helpfully, "Romance."  The other three (That Awkard Moment..., I'd Forgotten People are Kind, "Back From the Future..."), appear to be comedies (Humor), or Hurt/Comfort, a relationship driven genre can be, but is not always, platonic.

Since there subjectively seems to be more variation in our classic literature sample, compared to our sample fanfiction, let's look at a few structural differences and see if this potential difference is reflected there.

Before we start on our analysis of the differences between classical literature and modern fanfiction, let's take a brief detour to see how the individual titles in our sample differ from each other.



```{r}
df.lit.words<-subset(df.word,lit_type=="Book") %>%
  select(title,POS_word,count) %>%
  group_by(title) %>%
  summarise(word_count = sum(count)) %>%
  arrange(desc(word_count))
df.ff.words<-subset(df.word,lit_type=="Fanfiction") %>%
  select(title,POS_word,count) %>%
  group_by(title) %>%
  summarise(word_count = sum(count)) %>%
  arrange(desc(word_count))

c(min(df.lit.words$word_count),max(df.lit.words$word_count))
c(min(df.ff.words$word_count),max(df.ff.words$word_count))

# ggplot(data=df.lit.words,aes(x=title,y=word_count)) +
#   geom_bar(stat="identity",position="dodge2")
# 
# ggplot(data=df.ff.words,aes(x=title,y=word_count)) +
#   geom_bar(stat="identity",position="dodge2")

fig.word.count <- plot_ly(x = df.lit.words$word_count, type = "box", quartilemethod="linear", name="Classic Literature") %>%
  add_trace(x = df.ff.words$word_count, quartilemethod="linear", name="Modern Fanfiction") %>%
  layout(title = "Word Counts in Literature Types")

fig.word.count
```
In our sample, the longest piece of classic literature is Aurora Leigh, at 89,224 words, while the shortest is the three little pigs, at 1,109, meaning our longest piece is almost 90 times the length of our shortest.

On the fanfiction side, our longest is The Marks we Make, at 270,559 words, while the shortest is That Awkward Moment When Your Whole Class Shows up At Your House, at 28,918, just shy of a tenth the length of our longest.

Although the extremes of our classic lit. sample are proportionally much more spread out, they're actually distributed much more evenly, as can be seen by the squat inner quartiles in the graph above.

There are certainly examples outside our sample of one group far surpassing the other in either direction: War and Peace is nearly 600,000 words, while the entire genre colloquially known as "CrackFic" is premised around being under 100.


Next, we're going to look at parts of speech.  The natural language processing method we used recognizes ~34 'parts of speech', but we're going to be focusing on the standard English ones.  The 'extra' parts of speech in the package are more specific applications of the basic ones: for example, 'big','bigger',and 'biggest' are all adjectives, but the package would categorize them as simple, comparative, and superlative adjectives.

We're going to look at what proportion of the text of each story the 6 most common parts of speech make up.  These are singular nouns, pronouns,prepositions,determiners, simple adjectives, and simple adverbs.

```{r}
#Classic Lit: Top 5 POS
df.lit.words<- subset(df.word,lit_type=="Book") %>%
  select(title,POS_word,proportion)

df.lit.words$title<-gsub("Ã¨","e",gsub("\n","",df.lit.words$title))

df.lit.words.top5 <-subset(df.lit.words,POS_word %in% c('NN','IN','PRP','DT','JJ','RB')) %>%
  arrange(POS_word,desc(proportion))

df.lit.words.top5$proportion<-df.lit.words.top5$proportion*100

#Bar
#ggplot(data=df.lit.words.top5,aes(x=POS_word,y=proportion)) + geom_bar(stat="identity",position="dodge2",color="black")

#Box
fig.class.nn <- plot_ly(x = subset(df.lit.words.top5,POS_word=='NN')$proportion, type = "box", quartilemethod="linear", name="Singular Nouns") %>%
  add_trace(x = subset(df.lit.words.top5,POS_word=='IN')$proportion, type = "box", quartilemethod="linear", name="Preposition") %>%
  add_trace(x = subset(df.lit.words.top5,POS_word=='PRP')$proportion, type = "box", quartilemethod="linear", name="Pronouns") %>%
  add_trace(x = subset(df.lit.words.top5,POS_word=='DT')$proportion, type = "box", quartilemethod="linear", name="Determiners") %>%
  add_trace(x = subset(df.lit.words.top5,POS_word=='JJ')$proportion, type = "box", quartilemethod="linear", name="Adjectives") %>%
  add_trace(x = subset(df.lit.words.top5,POS_word=='RB')$proportion, type = "box", quartilemethod="linear", name="Adverb") %>%
  layout(title = "Top 5 POS - Classic Literature",
        yaxis = list(title="Part of Speech"),
        xaxis = list(title="Percentage of Words in Text",range=c(0,25))
        )
        
fig.class.nn
#df.lit.words.top5
```
```{r}
#Fanfiction: Top 5 POS
df.lit.words<- subset(df.word,lit_type=="Fanfiction") %>%
  select(title,POS_word,proportion)

df.lit.words.top5 <-subset(df.lit.words,POS_word %in% c('NN','IN','PRP','DT','JJ','RB')) %>%
  arrange(POS_word,desc(proportion))

df.lit.words.top5$proportion<-df.lit.words.top5$proportion*100
#Bar
#ggplot(data=df.lit.words.top5,aes(x=POS_word,y=proportion)) + geom_bar(stat="identity",position="dodge2",color="black")

#Box
fig.class.nn <- plot_ly(x = subset(df.lit.words.top5,POS_word=='NN')$proportion, type = "box", quartilemethod="linear", name="Singular Nouns") %>%
  add_trace(x = subset(df.lit.words.top5,POS_word=='IN')$proportion, type = "box", quartilemethod="linear", name="Preposition") %>%
  add_trace(x = subset(df.lit.words.top5,POS_word=='PRP')$proportion, type = "box", quartilemethod="linear", name="Pronouns") %>%
  add_trace(x = subset(df.lit.words.top5,POS_word=='DT')$proportion, type = "box", quartilemethod="linear", name="Determiners") %>%
  add_trace(x = subset(df.lit.words.top5,POS_word=='JJ')$proportion, type = "box", quartilemethod="linear", name="Adjectives") %>%
  add_trace(x = subset(df.lit.words.top5,POS_word=='RB')$proportion, type = "box", quartilemethod="linear", name="Adverb") %>%
  layout(title = "Top 5 POS - Fanfiction",
        yaxis = list(title="Part of Speech"),
        xaxis = list(title="Percentage of Words in Text",range=c(0,25))
        )
fig.class.nn
df.lit.words.top5
```
What really stands out here is, again, there's a lot of variation in our classical literature that we're not seeing in our fanfiction sample.  However, every part of speech has at least one story from our sample that is a statistical outlier compared to the others.  Also noteworthy is the proportionally smaller number of singular nouns used in fanfiction.


```{r}
# for i in lstPOS:
#     j+=1
#     if i=='NN' or i=='NNP' or i=='NNPS' or i=='NNS' or i=='PRP' or i=='WP':
#         lstPOS[j]='Noun'
#     elif i=='VB' or i=='VBD' or i=='VBG' or i=='VBN' or i=='VBP' or i=='VBZ' or i=='MD':
#         lstPOS[j]='Verb'
#     elif i=='JJ' or i=='JJR' or i=='JJS' or i=='POS' or i=='PRP$':
#         lstPOS[j]='Adj'
#     elif i=='RB' or i=='RBR' or i=='RBS' or i=='WRB':
#         lstPOS[j]='Adv'
#     else: #POS not listed above are dropped
#         lstPOS[j]=''

df.lit.words<-subset(df.word,lit_type=="Book")
df.noun <-subset(df.lit.words,POS_word %in% c('NN','NNP','NNPS','NNS','PRP','WP'))
df.verb <-subset(df.lit.words,POS_word %in% c('VB','VBD','VBG','VBN','VBP','VBZ','MD'))
df.adj <-subset(df.lit.words,POS_word %in% c('JJR','JJS','POS','PRP$'))
df.adv <- subset(df.lit.words,POS_word %in% c('RB','RBR','RBS','WRB'))
```

```{r}
df.lit.sent<-subset(df.ss_s,lit_type=="Book") %>%
  select(title,SS_simple,count) %>%
  group_by(title) %>%
  summarise(count = sum(count)) %>%
  arrange(desc(count))
df.ff.sent<-subset(df.ss_s,lit_type=="Fanfiction") %>%
  select(title,SS_simple,count) %>%
  group_by(title) %>%
  summarise(count = sum(count)) %>%
  arrange(desc(count))

df.lit.words<-subset(df.word,lit_type=="Book") %>%
  select(title,POS_word,count) %>%
  group_by(title) %>%
  summarise(word_count = sum(count)) %>%
  arrange(desc(word_count))
df.ff.words<-subset(df.word,lit_type=="Fanfiction") %>%
  select(title,POS_word,count) %>%
  group_by(title) %>%
  summarise(word_count = sum(count)) %>%
  arrange(desc(word_count))

df.lit<-cbind(df.lit.words,unique_sentences=df.lit.sent$count[match(df.lit.words$title,df.lit.sent$title)])
df.ff<-cbind(df.ff.words,unique_sentences=df.ff.sent$count[match(df.ff.words$title,df.ff.sent$title)])
df.lit$lit_type<-"Classic Literature"
df.ff$lit_type<-"Fanfiction"
df.scatter<-rbind(df.lit,df.ff)

ggplot(data=df.scatter, aes(x=word_count, y=unique_sentences,col=lit_type,group=lit_type)) + 
  geom_point() +
  geom_smooth(method=lm, aes(color=lit_type))+
  labs(title="Unique Sentence Structure and Story Length",
       x="Length (Word Count)", y = "Unique Sentence Structures")+
  theme_classic() 
```
Another metric we looked at was the number of unique sentence structures (SS) in each story.  As it turns out, there are MANY ways to put together a sentence in English, so in this case we used a simplified way of structuring a sentence: nouns (including pronouns), verbs, adjectives, and adverbs only, no punctuation.  Despite this, we still had stories with nearly (but not over) 9,000 unique sentence structures.

Intuitively, a longer story will have more unique SS in it, and this seems to pan out in our data.  However, the relationship between length and unique 
